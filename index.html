<!DOCTYPE html>

<html>
<head>
  <title>build.xml</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="layout.css" />
  <style>
    /*--------------------- Layout and Typography ----------------------------*/
body { font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif; font-size: 15px; line-height: 22px; color: #252519; margin: 0; padding: 0;
}
a { color: #261a3b;
} a:visited { color: #261a3b; }
p { margin: 0 0 15px 0;
}
h1, h2, h3, h4, h5, h6 { margin: 40px 0 15px 0;
} h3, h4, h5, h6 { margin-top: 20px; }
#container { position: relative;
}
#background { position: fixed; top: 0; left: 575px; right: 0; bottom: 0; background: #f5f5ff; border-left: 1px solid #e5e5ee; z-index: -1;
}
#jump_to, #jump_page { background: white; -webkit-box-shadow: 0 0 25px #777; -moz-box-shadow: 0 0 25px #777; -webkit-border-bottom-left-radius: 5px; -moz-border-radius-bottomleft: 5px; font: 10px Arial; text-transform: uppercase; cursor: pointer; text-align: right;
}
#jump_to, #jump_wrapper { position: fixed; right: 0; top: 0; padding: 5px 10px;
} #jump_wrapper { padding: 0; display: none; } #jump_to:hover #jump_wrapper { display: block; } #jump_page { padding: 5px 0 3px; margin: 0 0 25px 25px; overflow:hidden; } #jump_page .source { display: block; padding: 5px 10px; text-decoration: none; border-top: 1px solid #eee; float:left; min-width:180px; text-align:left; text-transform:none; font-size:11px; } #jump_page .source:hover { background: #f5f5ff; } #jump_page .source:first-child { }
table td { border: 0; outline: 0;
} td.docs, th.docs { max-width: 450px; min-width: 450px; min-height: 5px; padding: 10px 25px 1px 50px; overflow-x: hidden; vertical-align: top; text-align: left; } .docs pre { margin: 15px 0 15px; padding-left: 15px; } .docs p tt, .docs p code { background: #f8f8ff; border: 1px solid #dedede; font-size: 12px; padding: 0 0.2em; } .pilwrap { position: relative; } .pilcrow { font: 12px Arial; text-decoration: none; color: #454545; position: absolute; top: 3px; left: -20px; padding: 1px 2px; opacity: 0; -webkit-transition: opacity 0.2s linear; } td.docs:hover .pilcrow { opacity: 1; } td.code, th.code { padding: 14px 15px 16px 25px; width: 100%; vertical-align: top; background: #f5f5ff; border-left: 1px solid #e5e5ee; } pre, tt, code { font-size: 12px; line-height: 18px; font-family: Monaco, Consolas, "Lucida Console", monospace; margin: 0; padding: 0; } /*---------------------- Syntax Highlighting -----------------------------*/
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
body .hll { background-color: #ffffcc }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #954121 } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #808080 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0040D0 } /* Generic.Traceback */
body .kc { color: #954121 } /* Keyword.Constant */
body .kd { color: #954121; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #954121; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #954121 } /* Keyword.Pseudo */
body .kr { color: #954121; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #219161 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #954121 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #954121; font-weight: bold } /* Name.Tag */
body .nv { color: #19469D } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #219161 } /* Literal.String.Backtick */
body .sc { color: #219161 } /* Literal.String.Char */
body .sd { color: #219161; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #219161 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #219161 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #954121 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #219161 } /* Literal.String.Single */
body .ss { color: #19469D } /* Literal.String.Symbol */
body .bp { color: #954121 } /* Name.Builtin.Pseudo */
body .vc { color: #19469D } /* Name.Variable.Class */
body .vg { color: #19469D } /* Name.Variable.Global */
body .vi { color: #19469D } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */ /********** PHP Comment Additions ********/
td.docs .docparam {color:#DB251A;font-weight:bold;}
  </style>
</head>
<body>
  <div id="container">
    <div id="background"></div>
          <div id="jump_to">
        Jump To &hellip;
        <div id="jump_wrapper">
          <div id="jump_page">
                                          <a class="source" href="./build.html">
                              build.xml              </a>
                      </div>
        </div>
      </div>
        <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs">
            <h1>
              build.xml            </h1>
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
                  <tr id="section-0">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-0">&#182;</a>
              </div>
              
            </td>
            <td class="code">
              <div class="highlight"><pre><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-1">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p><strong>Phing Drupal Template</strong> is a XML build file for the
<strong><a href="http://www.phing.info/trac/">Phing build system</a></strong> with tasks and
configuration designed for <strong><a href="http://drupal.org">Drupal</a></strong> projects.</p>

<p>The aim of the project is to provide a build file which can be used with a
contiuous integration server to ensure clean code - check for compilation
errors, run unit tests, lint code and verify that code standards are upheld.</p>

<p>It has been tested with <a href="http://jenkins-ci.org/">Jenkins</a> but may work with
other systems.</p>

<h3>Usage</h3>

<p>The template can be used in several ways:</p>

<ul>
<li><p>As a starting point for your own build files. Download
<a href="https://raw.github.com/reload/phing-drupal-template/master/build.xml"><code>build.xml</code></a>
to the root directory of your Drupal project and modify it as needed.</p></li>
<li><p>As the actual build file for your project. You can configure most aspects of
the build according to your project through a properties file. Download
the entire project and place it in a subfolder or use it as a
<a href="http://kernel.org/pub/software/scm/git/docs/git-submodule.html">git submodule</a>.
Using the <code>build</code> subfolder from the root directory is recommended. Copy the
<code>build.default.properties</code> file to the root directory, rename it
<code>build.properties</code> and modify it according to your project.</p></li>
</ul>

<h3>Requirements</h3>

<p>Using the template requires a range of PEAR packages present. They can be
installed as follows:</p>

<pre><code>pear channel-discover pear.phpmd.org
pear channel-discover pear.phpunit.de
pear channel-discover components.ez.no
pear channel-discover pear.symfony-project.com

pear install phpmd/PHP_PMD
pear install phpunit/phpcpd
pear install phpunit/phploc
pear install PHPDocumentor
pear install PHP_CodeSniffer
pear install HTTP_Request2
pear install -a phpunit/PHP_CodeBrowser
</code></pre>

<p>The following must be available from the command line:</p>

<ul>
<li><a href="http://drupal.org/project/drush">Drush</a>: The Drupal shell.
<a href="http://drupalcode.org/project/drush.git/blob/HEAD:/README.txt">Installation instructions</a>.</li>
<li>Java Runtime Environment</li>
</ul>

<p>A Jenkins template project which utilizes the output generated by the build
is in the works.</p>

<h3>Credits</h3>

<p>The build file is heavily inspired by Sebastian Bergmans wonderful <a href="http://jenkins-php.org/">template
for Jenkins Jobs for PHP Projects</a> and began as a
Phing port of his suggested Apache Ant build file.</p>

<p>Many of the same tools are used: <a href="http://sebastianbergmann.github.com/phploc/">phploc</a>,
<a href="https://github.com/sebastianbergmann/phpcpd">phpcpd</a>,
<a href="http://phpmd.org/">PHPMD</a>, <a href="http://www.phpdoc.org/">phpDocumentor</a> and <a href="https://github.com/Mayflower/PHP_CodeBrowser">PHP_CodeBrowser</a>.</p>

<p>A couple of additional external tools are downloaded and used during the
build process:</p>

<ul>
<li><a href="http://git.drupal.org/sandbox/mongolito404/1157574.git">Phing Drush Task</a>:
A custom task for running drush from Phing</li>
<li><a href="https://github.com/raphaelstolt/phploc-phing">Phing PHPLoc</a>: A custom task
for running phploc from Phing</li>
<li><a href="http://jslint4java.googlecode.com/">jslint4java</a>: Supports execution of
jslint from the command line</li>
<li><a href="https://github.com/mikewest/JSLint">jslint´</a>: A more humane version of
Douglas Crockfords JSLint.</li>
<li><a href="http://csslint.net">csslint</a>: A tool to help point out problems with CSS code.</li>
<li><a href="http://www.mozilla.org/rhino/download.html">Mozilla Rhino</a>: An implementation of Javascript in Java.</li>
<li><a href="http://drupal.org/project/coder">Coder</a>: Drupal module for
performing code reviews.</li>
</ul>

<p>This documentation has been generated by
<a href="https://github.com/oneblackbear/phrocco">phrocco</a>
- a PHP port of the literate documentation generator Docco.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre><span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">&quot;phing-drupal&quot;</span> <span class="na">default=</span><span class="s">&quot;build&quot;</span> <span class="na">basedir=</span><span class="s">&quot;.&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-2">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Main targets</h2>
            </td>
            <td class="code">
              <div class="highlight"><pre></pre></div>            </td>
          </tr>
                  <tr id="section-3">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3>Build project</h3>

<p>Do a complete build of the project by verifying code consistency and and
performing static analysis of the code.</p>

<p>This is the default build taget.</p>

<p>Do not run <code>docs</code> for now. Generating documentation eats up memory and build
time and is largely obsolete when using GitHub.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;build&quot;</span> <span class="na">depends=</span><span class="s">&quot;init,</span>
<span class="s">                                clean,</span>
<span class="s">                                verify,</span>
<span class="s">                                analyze&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-4">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h3>Verify code consistency</h3>

<p>Make sure that our code is clean and functional.</p>

<p>Do not run <code>simpletest</code> for now until we figure out how to speed up tests
and/or only run for custom code</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;verify&quot;</span> <span class="na">depends=</span><span class="s">&quot;init,</span>
<span class="s">                                 clean,</span>
<span class="s">                                 lint-php-custom,</span>
<span class="s">                                 lint-js-custom,</span>
<span class="s">                                 lint-css-custom,</span>
<span class="s">                                 check-php-debug,</span>
<span class="s">                                 check-js-debug&quot;</span><span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-5">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3>Analyze code</h3>

<p>Perform static analysis of the code to generate statistics, identify potential
problems and opportunities for refactorings and make sure that the code
complies with coding standards.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;analyze&quot;</span> <span class="na">depends=</span><span class="s">&quot;init,</span>
<span class="s">                                  clean,</span>
<span class="s">                                  phploc,</span>
<span class="s">                                  phpmd,</span>
<span class="s">                                  phpcpd&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-6">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Moved inside target to support properties in target name</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;coder-review-d${drupal.version}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-7">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h3>Generate documentation</h3>

<p>Generate HTML documentation and code browser for the project.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;docs&quot;</span> <span class="na">depends=</span><span class="s">&quot;init,</span>
<span class="s">                               clean,</span>
<span class="s">                               phpdoc,</span>
<span class="s">                               phpcb&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-8">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2>Individual targets</h2>

<p>These tasks can be executed individually or grouped unless explicitly
stated as a part of the task.</p>

<p><strong>As a rule tasks without descriptions should not be executed directly.</strong></p>
            </td>
            <td class="code">
              <div class="highlight"><pre></pre></div>            </td>
          </tr>
                  <tr id="section-9">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3>PHP linting</h3>

<p>Check files for syntax errors.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;lint-php&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Check all PHP files for syntax errors using PHPLint&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;phplint&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.php&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/phplint&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;lint-php-custom&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Check custom PHP files for syntax errors using PHPLint&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;phplint&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.php.custom&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/phplint&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-10">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3>Javascript linting</h3>

<p>Checks code against <a href="http://www.jslint.com/">jslint</a> to assure a coding
standard is followed and detect potential problems. By default
<a href="https://github.com/mikewest/JSLint">jslint´</a> is used.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;lint-js&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Check all Javascript files using JSlint&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init, setup-jslint4java, setup-jslint&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;foreach</span> <span class="na">target=</span><span class="s">&quot;jslint-file&quot;</span> <span class="na">param=</span><span class="s">&quot;filename&quot;</span> <span class="na">absparam=</span><span class="s">&quot;absfilename&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.js&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/foreach&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;lint-js-custom&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Check custom Javascript files using JSlint&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init, setup-jslint4java, setup-jslint&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;foreach</span> <span class="na">target=</span><span class="s">&quot;jslint-file&quot;</span> <span class="na">param=</span><span class="s">&quot;filename&quot;</span> <span class="na">absparam=</span><span class="s">&quot;absfilename&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.js.custom&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/foreach&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-11">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4>jslint a file</h4>

<p>No need to run init or setup tasks here. This task should only be called from
parent <code>lint-js</code> tasks.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;jslint-file&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;echo&gt;</span>Linting file: ${absfilename}<span class="nt">&lt;/echo&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-12">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Execute jslint4java and return the result in checkstyle format</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;exec</span> <span class="na">command=</span><span class="s">&quot;java -jar ${jslint4java.file}</span>
<span class="s">                   --jslint ${jslint.file} --report checkstyle ${absfilename}&quot;</span>
          <span class="na">outputProperty=</span><span class="s">&quot;report&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-13">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Print the result to a file.
         Replace / with - in path to create legal filenames in the format
         <code>checkstyle-jslint-dir1-dir2-file.js.xml</code>.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;str_replace&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;filename.normalized&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;/&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;-&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${filename}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">file=</span><span class="s">&quot;${project.logdir}/checkstyle-jslint-${filename.normalized}.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;append</span> <span class="na">text=</span><span class="s">&quot;${report}&quot;</span>  <span class="na">destFile=</span><span class="s">&quot;${project.logdir}/checkstyle-jslint-${filename.normalized}.xml&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-14">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h4>Setup jslint4java</h4>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-jslint4java&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span>
          <span class="na">unless=</span><span class="s">&quot;project.jslint4java.setup&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jslint4java.dir&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/jslint4java&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;basename&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;jslint4java.basename&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${jslint4java.url}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-15">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>We assume that the version of jslint4java used is a distribution
           where the filename ends in <code>-dist.zip</code></p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;-dist.zip&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-16">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Download and unpack jslint4java</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${jslint4java.dir}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;basename&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;jslint4java.zipfile&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${jslint4java.url}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="nt">&lt;httpget</span> <span class="na">url=</span><span class="s">&quot;${jslint4java.url}&quot;</span>
             <span class="na">dir=</span><span class="s">&quot;${jslint4java.dir}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;unzip</span> <span class="na">file=</span><span class="s">&quot;${jslint4java.dir}/${jslint4java.zipfile}&quot;</span>
           <span class="na">todir=</span><span class="s">&quot;${jslint4java.dir}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-17">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Other tasks use this property to determine the location of the
         <code>jslint4java.jar</code> file</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jslint4java.file&quot;</span>
 <span class="na">value=</span><span class="s">&quot;${jslint4java.dir}/${jslint4java.basename}/${jslint4java.basename}.jar&quot;</span><span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-18">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Set property to prevent unnecessary additional invocations of this
         target</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.jslint4java.setup&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-19">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h4>Setup jslint</h4>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-jslint&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span>
          <span class="na">unless=</span><span class="s">&quot;project.jslint.setup&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;setup-git-repo&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.dir&quot;</span> <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/jslint&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.url&quot;</span> <span class="na">value=</span><span class="s">&quot;${jslint.repository}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/phingcall&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-20">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Other tasks use this property to determine the location of the jslint
         file</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jslint.file&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/jslint/${jslint.file}&quot;</span>
              <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-21">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Set property to prevent unnecessary additional invocations of this
         target</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.jslint.setup&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-22">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h3>CSS linting</h3>

<p>Checks code against <a href="http://www.csslint.net/">CSS Lint</a> to help point out problems with CSS code. It does basic syntax checking as well as applying a set of rules to the code that look for problematic patterns or signs of inefficiency.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre><span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;lint-css&quot;</span>
        <span class="na">description=</span><span class="s">&quot;Check all CSS files using CSS Lint&quot;</span>
        <span class="na">depends=</span><span class="s">&quot;init, setup-rhino, setup-csslint&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;foreach</span> <span class="na">target=</span><span class="s">&quot;csslint-file&quot;</span> <span class="na">param=</span><span class="s">&quot;filename&quot;</span> <span class="na">absparam=</span><span class="s">&quot;absfilename&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.css&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/foreach&gt;</span>
<span class="nt">&lt;/target&gt;</span>

<span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;lint-css-custom&quot;</span>
        <span class="na">description=</span><span class="s">&quot;Check custom CSS files using CSS Lint&quot;</span>
        <span class="na">depends=</span><span class="s">&quot;init, setup-rhino, setup-csslint&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;foreach</span> <span class="na">target=</span><span class="s">&quot;csslint-file&quot;</span> <span class="na">param=</span><span class="s">&quot;filename&quot;</span> <span class="na">absparam=</span><span class="s">&quot;absfilename&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.css.custom&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/foreach&gt;</span>
<span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-23">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h4>csslint a file</h4>

<p>No need to run init or setup tasks here. This task should only be called from
parent <code>lint-css</code> tasks.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;csslint-file&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;echo&gt;</span>Linting file: ${absfilename}<span class="nt">&lt;/echo&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-24">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Run csslint through Rhino and return the result in
         checkstyle format</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;exec</span> <span class="na">command=</span><span class="s">&quot;java -jar ${rhino.jar} ${csslint.rhino.file}</span>
<span class="s">                   --format=checkstyle-xml --rules=${csslint.rules}</span>
<span class="s">                   ${absfilename}&quot;</span>
          <span class="na">outputProperty=</span><span class="s">&quot;report&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-25">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Print the result to a file.
         Replace / with - in path to create legal filenames in the format
         <code>checkstyle-csslint-dir1-dir2-file.css.xml</code>.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;str_replace&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;filename.normalized&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;/&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;-&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${filename}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;csslint.report.file&quot;</span> <span class="na">value=</span><span class="s">&quot;${project.logdir}/checkstyle-csslint-${filename.normalized}.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">file=</span><span class="s">&quot;${csslint.report.file}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;append</span> <span class="na">text=</span><span class="s">&quot;${report}&quot;</span>  <span class="na">destFile=</span><span class="s">&quot;${csslint.report.file}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-26">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>CSS Lint reports parsing errors in CSS files using the Parsing
         Errors rule. Consequently if the checkstyle file contains errors
         with the net.csslint.ParsingErrors source a parsing error has been
         detected.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;loadfile</span> <span class="na">property=</span><span class="s">&quot;csslint.parseerrors&quot;</span>
      <span class="na">file=</span><span class="s">&quot;${csslint.report.file}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;filterchain&gt;</span>
        <span class="nt">&lt;linecontainsregexp&gt;</span>
            <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&quot;(net\.csslint\.ParsingErrors)&quot;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/linecontainsregexp&gt;</span>
      <span class="nt">&lt;/filterchain&gt;</span>
    <span class="nt">&lt;/loadfile&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-27">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Break if any parsing errors are detected!</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;if&gt;</span>
      <span class="nt">&lt;not&gt;</span>
        <span class="nt">&lt;equals</span> <span class="na">arg1=</span><span class="s">&quot;${csslint.parseerrors}&quot;</span> <span class="na">arg2=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/not&gt;</span>
      <span class="nt">&lt;then&gt;</span>
        <span class="nt">&lt;fail</span> <span class="na">message=</span><span class="s">&quot;CSS parsing error detected in file ${absfilename}&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/then&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-28">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h4>Setup csslint</h4>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-csslint&quot;</span>
           <span class="na">depends=</span><span class="s">&quot;init&quot;</span>
           <span class="na">unless=</span><span class="s">&quot;project.csslint.setup&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;setup-git-repo&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.dir&quot;</span> <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/csslint&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.url&quot;</span> <span class="na">value=</span><span class="s">&quot;${csslint.repository}&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/phingcall&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-29">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Other tasks use this property to determine the location of the
          csslint rhino file</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;csslint.rhino.file&quot;</span>
               <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/csslint/release/csslint-rhino.js&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-30">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Set property to prevent unnecessary additional invocations of this
          target</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.csslint.setup&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-31">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h3>Debug code detection</h3>

<p>Code should not call functions which are usually used for debugging.
This belongs on developer environments - not VCS.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;check-php-debug&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Check custom PHP code for debug statements&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;debug.language&quot;</span> <span class="na">value=</span><span class="s">&quot;PHP&quot;</span> <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;debug.pattern&quot;</span> <span class="na">value=</span><span class="s">&quot;(var_dump\(|dsm\(|dpm\()&quot;</span>
              <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;fileset</span> <span class="na">id=</span><span class="s">&quot;debug.fileset&quot;</span> <span class="na">refid=</span><span class="s">&quot;src.php.custom&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;strtolower&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;debug.language.lower&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${debug.language}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;debug.output&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.logdir}/debug_${debug.language.lower}.txt&quot;</span>
              <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">file=</span><span class="s">&quot;${debug.output}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;append</span> <span class="na">text=</span><span class="s">&quot;&quot;</span> <span class="na">destFile=</span><span class="s">&quot;${debug.output}&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;foreach</span> <span class="na">target=</span><span class="s">&quot;check-debug-file&quot;</span> <span class="na">param=</span><span class="s">&quot;filename&quot;</span>
             <span class="na">absparam=</span><span class="s">&quot;absfilename&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;debug.fileset&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/foreach&gt;</span>

    <span class="nt">&lt;loadfile</span> <span class="na">property=</span><span class="s">&quot;debug.lines&quot;</span> <span class="na">file=</span><span class="s">&quot;${debug.output}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-32">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Break if debug code is detected!</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;if&gt;</span>
      <span class="nt">&lt;not&gt;</span>
        <span class="nt">&lt;equals</span> <span class="na">arg1=</span><span class="s">&quot;${debug.lines}&quot;</span> <span class="na">arg2=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/not&gt;</span>
      <span class="nt">&lt;then&gt;</span>
        <span class="nt">&lt;fail</span> <span class="na">message=</span><span class="s">&quot;${debug.language} debug code detected:${line.separator}</span>
<span class="s">                       ${debug.lines}&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/then&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;check-js-debug&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Check custom Javascript code for debug statements&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;debug.language&quot;</span> <span class="na">value=</span><span class="s">&quot;Javascript&quot;</span> <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;debug.pattern&quot;</span> <span class="na">value=</span><span class="s">&quot;(console\.log\()&quot;</span> <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;fileset</span> <span class="na">id=</span><span class="s">&quot;debug.fileset&quot;</span> <span class="na">refid=</span><span class="s">&quot;src.js.custom&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;strtolower&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;debug.language.lower&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${debug.language}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;debug.output&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.logdir}/debug_${debug.language.lower}.txt&quot;</span>
              <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">file=</span><span class="s">&quot;${debug.output}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;append</span> <span class="na">text=</span><span class="s">&quot;&quot;</span> <span class="na">destFile=</span><span class="s">&quot;${debug.output}&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;foreach</span> <span class="na">target=</span><span class="s">&quot;check-debug-file&quot;</span> <span class="na">param=</span><span class="s">&quot;filename&quot;</span>
             <span class="na">absparam=</span><span class="s">&quot;absfilename&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;debug.fileset&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/foreach&gt;</span>

    <span class="nt">&lt;loadfile</span> <span class="na">property=</span><span class="s">&quot;debug.lines&quot;</span> <span class="na">file=</span><span class="s">&quot;${debug.output}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-33">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Break if debug code is detected!</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;if&gt;</span>
      <span class="nt">&lt;not&gt;</span>
        <span class="nt">&lt;equals</span> <span class="na">arg1=</span><span class="s">&quot;${debug.lines}&quot;</span> <span class="na">arg2=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/not&gt;</span>
      <span class="nt">&lt;then&gt;</span>
        <span class="nt">&lt;fail</span> <span class="na">message=</span><span class="s">&quot;${debug.language} debug code detected:${line.separator}</span>
<span class="s">                       ${debug.lines}&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/then&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-34">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h4>Check an individual file for debug code</h4>

<p>No need to run init here. This task should only be called through parent
<code>check-debug-*</code> tasks.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;check-debug-file&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;echo&gt;</span>Checking file for debug statements: ${absfilename}<span class="nt">&lt;/echo&gt;</span>
    <span class="nt">&lt;loadfile</span> <span class="na">property=</span><span class="s">&quot;debug.lines&quot;</span> <span class="na">file=</span><span class="s">&quot;${absfilename}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;filterchain&gt;</span>
        <span class="nt">&lt;linecontainsregexp&gt;</span>
            <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&quot;${debug.pattern}&quot;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/linecontainsregexp&gt;</span>
      <span class="nt">&lt;/filterchain&gt;</span>
    <span class="nt">&lt;/loadfile&gt;</span>
    <span class="nt">&lt;if&gt;</span>
      <span class="nt">&lt;not&gt;</span>
        <span class="nt">&lt;equals</span> <span class="na">arg1=</span><span class="s">&quot;${debug.lines}&quot;</span> <span class="na">arg2=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/not&gt;</span>
      <span class="nt">&lt;then&gt;</span>
        <span class="nt">&lt;append</span> <span class="na">text=</span><span class="s">&quot;${filename}:${line.separator}</span>
<span class="s">                      ${debug.lines}${line.separator}</span>
<span class="s">                      ${line.separator}&quot;</span>
                <span class="na">destFile=</span><span class="s">&quot;${debug.output}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/then&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-35">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h3>Detect code mess</h3>

<p>Uses <a href="http://phpmd.org/">PHPMD</a> to detect code mess and look for potential
problems.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;phpmd&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Generate pmd.xml using PHPMD&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-36">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>We do not use the unusedcode ruleset as Drupal hook implementations
         usually are declared with all arguements but may not use them
         all.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;phpmd</span> <span class="na">rulesets=</span><span class="s">&quot;codesize,naming,design&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.php.custom&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;formatter</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span> <span class="na">outfile=</span><span class="s">&quot;${project.logdir}/pmd.xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/phpmd&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-37">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h3>Detect potential copy/pasting</h3>

<p>Uses <a href="https://github.com/sebastianbergmann/phpcpd">phpcpd</a> to detect duplicate
code. This indicates potential refactorings.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;phpcpd&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Generate pmd-cpd.xml using phpcpd&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;phpcpd&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.php.custom&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;formatter</span> <span class="na">type=</span><span class="s">&quot;pmd&quot;</span> <span class="na">outfile=</span><span class="s">&quot;${project.logdir}/pmd-cpd.xml&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/phpcpd&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-38">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h3>Generate code statistics</h3>

<p>Measures the size of the project using
<a href="http://sebastianbergmann.github.com/phploc/">phploc</a> and generates
statistics.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;phploc&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Generate phploc.csv using phploc&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init, setup-phing-phploc&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-39">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Suffixes should be the same as included in the
         src.php filesets</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;phploc</span> <span class="na">reportType=</span><span class="s">&quot;csv&quot;</span>
            <span class="na">reportName=</span><span class="s">&quot;phploc&quot;</span> <span class="na">reportDirectory=</span><span class="s">&quot;${project.logdir}&quot;</span>
            <span class="na">suffixes=</span><span class="s">&quot;php,module,inc,install,profile,test&quot;</span> <span class="na">countTests=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.php.custom&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/phploc&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-40">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h4>Setup Phing phploc integration</h4>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-phing-phploc&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span> <span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-41">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Clone the project</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;setup-git-repo&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.dir&quot;</span> <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/phing-phploc&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.url&quot;</span> <span class="na">value=</span><span class="s">&quot;${phing.phploc.repository}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/phingcall&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-42">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Register the custom Phing task</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;taskdef</span> <span class="na">name=</span><span class="s">&quot;phploc&quot;</span> <span class="na">classname=</span><span class="s">&quot;PHPLocTask&quot;</span>
             <span class="na">classpath=</span><span class="s">&quot;${project.toolsdir}/phing-phploc&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-43">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h3>Drupal Coder review</h3>

<p>Review code using <a href="http://drupal.org/project/coder">Drupal coder module</a>.</p>

<p>Configuration of which modules and themes to review is done in
<code>build.properties</code>. If your modules use a common prefix such as
<code>yourproject_module1</code>, <code>yourproject_module2</code> you can add all modules with a
specific prefix.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;coder-review-d6&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Review code using Drupal 6 Coder module&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;echo</span> <span class="na">level=</span><span class="s">&quot;warning&quot;</span><span class="nt">&gt;</span>Coder Review is not supported for Drupal 6 yet.
                          Check http://drupal.org/node/858330 for
                          patches/updates.<span class="nt">&lt;/echo&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;coder-review-d7&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Review code using Drupal 7 Coder module&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init, clean, site-install&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-44">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Setup properties for installing and running Coder Review.
         For some reason these properties are not passed correctly through to
         subtasks when defining them within the phingcall.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;coder.version&quot;</span> <span class="na">value=</span><span class="s">&quot;7.x-1.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;coder.review.module&quot;</span> <span class="na">value=</span><span class="s">&quot;coder_review&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;coder.review.command&quot;</span> <span class="na">value=</span><span class="s">&quot;coder-review&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;setup-coder-review&quot;</span><span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-45">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Perform actual coder review for each style</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;foreach</span> <span class="na">target=</span><span class="s">&quot;coder-review&quot;</span> <span class="na">param=</span><span class="s">&quot;coder.review.type&quot;</span>
             <span class="na">list=</span><span class="s">&quot;comment,i18n,security,sql,style&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-46">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h4>Perform coder review</h4>

<p>This tasks requires properties set by calling tasks coder-review-d6 or
coder-review-d7</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;coder-review&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init, setup-phing-drush&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-47">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Get a list of modules and themes matching the project prefix.
         These are the ones we are going to review.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;pm-list&quot;</span> <span class="na">pipe=</span><span class="s">&quot;projects&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-48">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>The project list is piped through a file as this seems to be
         the only way to handle filtering of values in Phing.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;delete</span> <span class="na">file=</span><span class="s">&quot;${project.basedir}/build/logs/projects.txt&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;append</span> <span class="na">text=</span><span class="s">&quot;${projects}&quot;</span> <span class="na">destFile=</span><span class="s">&quot;${project.logdir}/projects.txt&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;loadfile</span> <span class="na">property=</span><span class="s">&quot;project.code.projects&quot;</span>
              <span class="na">file=</span><span class="s">&quot;${project.logdir}/projects.txt&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;filterchain&gt;</span>
        <span class="nt">&lt;linecontainsregexp&gt;</span>
          <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&quot;^${project.code.prefix}_&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/linecontainsregexp&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-49">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Prefix all lines with a space.
             We need the space as separator when we strip line breaks</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;prefixlines</span> <span class="na">prefix=</span><span class="s">&quot; &quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;striplinebreaks</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/filterchain&gt;</span>
    <span class="nt">&lt;/loadfile&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-50">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Execute coder review and output results in XML format</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;${coder.review.command}&quot;</span> <span class="na">assume=</span><span class="s">&quot;yes&quot;</span> <span class="na">pipe=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param&gt;</span>no-empty<span class="nt">&lt;/param&gt;</span>
      <span class="nt">&lt;param&gt;</span>xml<span class="nt">&lt;/param&gt;</span>
      <span class="nt">&lt;param&gt;</span>minor<span class="nt">&lt;/param&gt;</span>
      <span class="nt">&lt;param&gt;</span>${coder.review.type}<span class="nt">&lt;/param&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-51">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Review all the modules and themes matching the project prefix</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nt">&lt;param&gt;</span>${project.code.projects}<span class="nt">&lt;/param&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-52">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Review additional modules which do not match the prefix</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nt">&lt;param&gt;</span>${project.code.custom}<span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/drush&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-53">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Write XML output to file</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;coderreview.checkstyle.file&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.logdir}/checkstyle-${coder.review.type}.xml&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">file=</span><span class="s">&quot;${coderreview.checkstyle.file}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;append</span> <span class="na">destFile=</span><span class="s">&quot;${coderreview.checkstyle.file}&quot;</span> <span class="na">text=</span><span class="s">&quot;${xml}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-54">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Modify Coder Review XML output to match CheckStyle XML report format</p>

<ul>
<li>Convert root element from coderreview to checkstyle</li>
<li>Convert severities from Drupal minor/normal/critical to CheckStyle
info/warning/error</li>
<li>Convert source from source extract to Category.Type format</li>
</ul>

<p>This could probably be handled better using an XSLT. Use string replacement for now.</p>

<p>Filter chains does not seem to work in append so we load the file again.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;ucwords&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;type&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${coder.review.type}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="nt">&lt;reflexive</span> <span class="na">file=</span><span class="s">&quot;${coderreview.checkstyle.file}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;filterchain&gt;</span>
        <span class="nt">&lt;replaceregexp&gt;</span>
          <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&quot;coderreview&quot;</span>
                  <span class="na">replace=</span><span class="s">&quot;checkstyle&quot;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&#39;severity=&quot;minor&quot;&#39;</span>
                  <span class="na">replace=</span><span class="s">&#39;severity=&quot;info&quot;&#39;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&#39;severity=&quot;normal&quot;&#39;</span>
                  <span class="na">replace=</span><span class="s">&#39;severity=&quot;warning&quot;&#39;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&#39;severity=&quot;critical&quot;&#39;</span>
                  <span class="na">replace=</span><span class="s">&#39;severity=&quot;error&quot;&#39;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;regexp</span> <span class="na">pattern=</span><span class="s">&#39;source=&quot;.*&quot;&#39;</span>
                  <span class="na">replace=</span><span class="s">&#39;source=&quot;Drupal.CoderReview.${type}&quot;&#39;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/replaceregexp&gt;</span>
      <span class="nt">&lt;/filterchain&gt;</span>
    <span class="nt">&lt;/reflexive&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-55">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h4>Setup Coder module for performing code reviews</h4>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-coder-review&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-56">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Download Coder module</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;pm-download&quot;</span> <span class="na">assume=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param&gt;</span>coder-${coder.version}<span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/drush&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-57">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Enable module facilitating Coder reviews. This varies between
         Drupal 6 and 7 versions.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;pm-enable&quot;</span> <span class="na">assume=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param&gt;</span>${coder.review.module}<span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/drush&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-58">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h3>Review code using PHP_CodeSniffer</h3>

<p>The purpose and outcome of this task is the same as the coder-review tasks.
In general <a href="http://pear.php.net/package/PHP_CodeSniffer/">PHP_CodeSniffer</a>
is faster to execute but there does not seem to be a complete ruleset which
covers all of the
<a href="http://drupal.org/coding-standards">Drupal coding standards</a>.</p>

<p>Consequently <code>coder-review-d6/7</code> and not <code>phpcs</code> is used for the main targets.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;phpcs&quot;</span>
            <span class="na">description=</span><span class="s">&quot;Generate checkstyle.xml using PHP_CodeSniffer&quot;</span>
            <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-59">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Clone a repository containing Drupal code guidelines for
           PHP_CodeSniffer.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;setupgitrepo&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.dir&quot;</span> <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/drupalcs&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.url&quot;</span> <span class="na">value=</span><span class="s">&quot;${phpcs.drupalcs.repository}&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/phingcall&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-60">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>There is no Phing task for PHP Codesniffer in v2.4.6.
           It's coming for v2.5. Execute while we wait.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nt">&lt;exec</span> <span class="na">command=</span><span class="s">&quot;phpcs --report=checkstyle</span>
<span class="s">                    --report-file=${project.logdir}/checkstyle-codesniffer.xml</span>
<span class="s">                    --standard=${project.toolsdir}/drupalcs/ruleset.xml</span>
<span class="s">                    --extensions=php,inc</span>
<span class="s">                    --ignore=*/contrib/*,*/*.features.*,*/*.field_group.inc,</span>
<span class="s">                             */*.layout.*,*/*.pages_default.*,</span>
<span class="s">                             */*.panels_default.*,*/*strongarm.inc,</span>
<span class="s">                             */*.views_default.inc,</span>
<span class="s">                    ${project.sitesdir}&quot;</span>
            <span class="na">logoutput=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-61">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <h3>Run simpletests</h3>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;simpletest&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Run all unit tests&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init, clean, setup-phing-drush, site-install&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-62">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Download and enable simpletest module</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;pm-download&quot;</span> <span class="na">assume=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param&gt;</span>simpletest<span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/drush&gt;</span>
    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;pm-enable&quot;</span> <span class="na">assume=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;param&gt;</span>simpletest<span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/drush&gt;</span>
    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;test-run&quot;</span> <span class="na">assume=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;all&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-63">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>XML output requires a drush 4.5 or
          <a href="http://drupal.org/node/1109408">a patch</a>.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>${project.testdir}/tests<span class="nt">&lt;/option&gt;</span>
    <span class="nt">&lt;/drush&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-64">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <h3>Generate documentation</h3>
            </td>
            <td class="code">
              <div class="highlight"><pre></pre></div>            </td>
          </tr>
                  <tr id="section-65">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <h4>Generate API Documentation</h4>

<p>Uses <a href="http://www.phpdoc.org/">phpDocumentor</a> to generate documentation.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;phpdoc&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Generate API documentation using phpDocumentor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${project.buildir/api&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;phpdoc</span> <span class="na">title=</span><span class="s">&quot;API Documentation&quot;</span>
            <span class="na">destdir=</span><span class="s">&quot;${project.builddir}/api&quot;</span>
            <span class="na">sourcecode=</span><span class="s">&quot;php&quot;</span>
            <span class="na">output=</span><span class="s">&quot;HTML:Smarty:PHP&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">refid=</span><span class="s">&quot;src.php&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/phpdoc&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-66">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h4>Generate a code browser</h4>

<p>Generate a code browser for PHP files with syntax highlighting and
colored error-sections using
<a href="https://github.com/Mayflower/PHP_CodeBrowser">PHP_CodeBrowser</a>.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;phpcb&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Aggregate tool output with PHP_CodeBrowser&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${project.basedir}/build/code-browser&quot;</span><span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-67">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>There is no Phing task for PHP CodeBrowser so do a plain execute.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;exec</span> <span class="na">command=</span><span class="s">&quot;phpcb  --log ${project.logdir}</span>
<span class="s">                          --source ${project.basedir}</span>
<span class="s">                          --output ${project.builddir}/code-browser&quot;</span>
          <span class="na">logoutput=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-68">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h2>Helper tasks</h2>

<p>These tasks are used throughout the project and should normally not be
executed directly.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre></pre></div>            </td>
          </tr>
                  <tr id="section-69">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h3>Initialization</h3>

<p>This target sets up many of the common resources used throughout the build.
All other targets except dependencies for this target should depend on this
unless specifically stated why.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;init&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;load-properties&quot;</span>
          <span class="na">unless=</span><span class="s">&quot;project.initialized&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-70">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Define working directories</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.sitesdir&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.basedir}/${project.code.dir}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.builddir&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.basedir}/build&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.toolsdir&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.builddir}/tools&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.coveragedir&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.builddir}/coverage&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.logdir&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.builddir}/logs&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.testdir&quot;</span>
              <span class="na">value=</span><span class="s">&quot;${project.builddir}/tests&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-71">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Define pattern sets for future reference</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;patternset</span> <span class="na">id=</span><span class="s">&quot;php&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.php&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.module&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.install&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.inc&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.profile&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.test&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/patternset&gt;</span>

    <span class="nt">&lt;patternset</span> <span class="na">id=</span><span class="s">&quot;js&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.js&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-72">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Minimized JavaScript files should not be analyzed.
           In their optimized state</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.min.js&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/patternset&gt;</span>

    <span class="nt">&lt;patternset</span> <span class="na">id=</span><span class="s">&quot;css&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.css&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/patternset&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-73">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Directories for community contributed code. We exclude these from
         code analysis
         as we cannot be held responsible for any problems here.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;patternset</span> <span class="na">id=</span><span class="s">&quot;contrib&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/contrib/**/*.*&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/libraries/**/*.*&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/patternset&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-74">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>We exclude generated files from We exclude these from code analysis
         as we cannot be held responsible for any problems here.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;patternset</span> <span class="na">id=</span><span class="s">&quot;generated&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.features.*&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.field_group.inc&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.layouts.inc&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.pages_default.inc&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.panels_default.inc&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.strongarm.inc&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;exclude</span> <span class="na">name=</span><span class="s">&quot;**/*.views_default.inc&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/patternset&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-75">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Define file sets for future reference</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;fileset</span>  <span class="na">id=</span><span class="s">&quot;src.php&quot;</span> <span class="na">dir=</span><span class="s">&quot;${project.basedir}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.php&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;**/*.inc&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/fileset&gt;</span>

    <span class="nt">&lt;fileset</span> <span class="na">id=</span><span class="s">&quot;src.php.custom&quot;</span> <span class="na">dir=</span><span class="s">&quot;${project.sitesdir}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;php&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;contrib&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;generated&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/fileset&gt;</span>

    <span class="nt">&lt;fileset</span> <span class="na">id=</span><span class="s">&quot;src.js&quot;</span> <span class="na">dir=</span><span class="s">&quot;${project.basedir}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;js&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/fileset&gt;</span>

    <span class="nt">&lt;fileset</span> <span class="na">id=</span><span class="s">&quot;src.css.custom&quot;</span> <span class="na">dir=</span><span class="s">&quot;${project.sitesdir}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;css&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;contrib&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/fileset&gt;</span>

    <span class="nt">&lt;fileset</span> <span class="na">id=</span><span class="s">&quot;src.css&quot;</span> <span class="na">dir=</span><span class="s">&quot;${project.basedir}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;css&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/fileset&gt;</span>

    <span class="nt">&lt;fileset</span> <span class="na">id=</span><span class="s">&quot;src.js.custom&quot;</span> <span class="na">dir=</span><span class="s">&quot;${project.sitesdir}&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;js&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;patternset</span> <span class="na">refid=</span><span class="s">&quot;contrib&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/fileset&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-76">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Set property to prevent target from being executed multiple times</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.initialized&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-77">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <h3>Load properties</h3>

<p>Loads a set of project specific properties from a <code>.properties</code> file.</p>

<p>These properties contain information regarding the individual project and/or
environment such as which version of Drupal you are using, how to create a
database and the names of your custom modules.</p>

<p>All available properties are described and set to a default value in
<a href="https://raw.github.com/reload/phing-drupal-template/master/build.default.properties"><code>build.default.properties</code></a>.
You can create your own properties file by copying the
<code>build.default.properties</code> file to the root directory, rename it
<code>build.properties</code> and modify it according to your project.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;load-properties&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-78">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Use condition instead of unless property as we cannot unset properties in Phing</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;if&gt;</span>
      <span class="nt">&lt;or&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-79">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p><code>istrue</code> evaluates to true is value is not set we need to check
             <code>isset</code> as well</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;not&gt;&lt;istrue</span> <span class="na">value=</span><span class="s">&quot;${project.properties.loaded}&quot;</span> <span class="nt">/&gt;&lt;/not&gt;</span>
        <span class="nt">&lt;not&gt;&lt;isset</span> <span class="na">property=</span><span class="s">&quot;project.properties.loaded&quot;</span> <span class="nt">/&gt;&lt;/not&gt;</span>
      <span class="nt">&lt;/or&gt;</span>
      <span class="nt">&lt;then&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-80">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>By default Jenkins runs Phing from the directory containing the build
file.  If this file is located in a subdirectory - e.g. when using Phing Drupal as a submodule - we need to reset the project basedir and reload properties.</p>

<p>NB: This only works if the subdirectory is directly within the Drupal
root directory.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;if&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-81">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>If <code>cron.php</code> exists then assume we have a Drupal root
               directory</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>          <span class="nt">&lt;available</span> <span class="na">file=</span><span class="s">&quot;${project.basedir}/../cron.php&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;then&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.basedir&quot;</span> <span class="na">value=</span><span class="s">&quot;${project.basedir}/../&quot;</span>
                      <span class="na">override=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;resolvepath</span> <span class="na">propertyName=</span><span class="s">&quot;project.basedir&quot;</span>
                         <span class="na">file=</span><span class="s">&quot;${project.basedir}&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/then&gt;</span>
        <span class="nt">&lt;/if&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-82">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>By default use default properties file
             <code>build.default.properties</code></p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.properties.file&quot;</span>
                  <span class="na">value=</span><span class="s">&quot;${phing.dir}/build.default.properties&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-83">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Allow override using <code>build.properties</code> in build file
             directory</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;dirname&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;phing.dir&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${phing.file}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/php&gt;</span>
        <span class="nt">&lt;available</span> <span class="na">file=</span><span class="s">&quot;${phing.dir}/build.properties&quot;</span>
                   <span class="na">property=</span><span class="s">&quot;project.properties.file&quot;</span>
                   <span class="na">value=</span><span class="s">&quot;${phing.dir}/build.properties&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-84">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Allow override using <code>build.properties</code> in project base
             directory</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;available</span> <span class="na">file=</span><span class="s">&quot;${project.basedir}/build.properties&quot;</span>
                   <span class="na">property=</span><span class="s">&quot;project.properties.file&quot;</span>
                   <span class="na">value=</span><span class="s">&quot;${project.basedir}/build.properties&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-85">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Load the properties.
             Override in case <code>load-properties</code> are called multiple times.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;property</span> <span class="na">file=</span><span class="s">&quot;${project.properties.file}&quot;</span> <span class="na">override=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-86">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Set property to prevent unnecessary additional invocations of this target</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.properties.loaded&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/then&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-87">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <h3>Clean working environment</h3>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;clean&quot;</span>
          <span class="na">description=</span><span class="s">&quot;Clean up and create artifact directories&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span>
          <span class="na">unless=</span><span class="s">&quot;project.cleaned&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-88">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Delete any existing artifacts from a previous build.
         Do not delete builddir. It may contain the build file!</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">&quot;${project.toolsdir}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">&quot;${project.coveragedir}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">&quot;${project.logdir}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">&quot;${project.testdir}&quot;</span><span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-89">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Verbose. We need to make sure any database is deleted. Reinstalling
         the site with an existing database causes the build to fail.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;delete</span> <span class="na">file=</span><span class="s">&quot;${project.basedir}/database.sqlite&quot;</span> <span class="na">verbose=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-90">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Remove leftover Drupal simpletest databases</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;delete&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">dir=</span><span class="s">&quot;${project.basedir}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;database.sqlite-simpletest*&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/fileset&gt;</span>
    <span class="nt">&lt;/delete&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-91">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Recreate directories for artifacts</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${project.toolsdir}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${project.coveragedir}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${project.logdir}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${project.testdir}&quot;</span><span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-92">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Set property to prevent target from being executed multiple times</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.cleaned&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-93">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <h3>Install a Drupal site</h3>

<p>This initializes a Drupal site using a installation profile.</p>

<p>Configuration of which installation profile and database to use in done in
<code>build.properties</code>.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;site-install&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init, setup-phing-drush&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;drush</span> <span class="na">command=</span><span class="s">&quot;site-install&quot;</span> <span class="na">assume=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;db-url&quot;</span><span class="nt">&gt;</span>${db.url}<span class="nt">&lt;/option&gt;</span>
      <span class="nt">&lt;param&gt;</span>${drupal.profile}<span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/drush&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-94">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <h3>Clone a git repository</h3>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-git-repo&quot;</span><span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-95">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Only clone if repository does not exist already</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;if&gt;</span>
      <span class="nt">&lt;not&gt;&lt;available</span> <span class="na">file=</span><span class="s">&quot;${repo.dir}&quot;</span> <span class="nt">/&gt;&lt;/not&gt;</span>
      <span class="nt">&lt;then&gt;</span>
        <span class="nt">&lt;echo&gt;</span>Cloning ${repo.url} into ${repo.dir}<span class="nt">&lt;/echo&gt;</span>
        <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${repo.dir}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-96">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>The <a href="http://www.phing.info/docs/guide/stable/chapters/appendixes/AppendixC-OptionalTasks.html#GitCloneTask"><code>gitclone</code> task</a>
             does not seem to work. Use exec instead</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nt">&lt;exec</span> <span class="na">command=</span><span class="s">&quot;git clone ${repo.url} ${repo.dir} --depth 1&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/then&gt;</span>
    <span class="nt">&lt;/if&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-97">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <h3>Setup Phing Drush integration</h3>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-phing-drush&quot;</span>
          <span class="na">depends=</span><span class="s">&quot;init&quot;</span> <span class="nt">&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-98">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Clone the project from Drupal.org</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;phingcall</span> <span class="na">target=</span><span class="s">&quot;setup-git-repo&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.dir&quot;</span> <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/phing-drush&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;repo.url&quot;</span> <span class="na">value=</span><span class="s">&quot;${phing.drush.repository}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/phingcall&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-99">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Register as custom Phing task</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nt">&lt;taskdef</span> <span class="na">name=</span><span class="s">&quot;drush&quot;</span> <span class="na">classname=</span><span class="s">&quot;DrushTask&quot;</span>
             <span class="na">classpath=</span><span class="s">&quot;${project.toolsdir}/phing-drush&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-100">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <h3>Setup Rhino</h3>

<p><a href="http://www.mozilla.org/rhino/">Mozilla Rhino</a> is an open-source implementation of JavaScript written in Java.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>   <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;setup-rhino&quot;</span>
           <span class="na">depends=</span><span class="s">&quot;init&quot;</span>
           <span class="na">unless=</span><span class="s">&quot;project.rhino.setup&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;rhino.dir&quot;</span>
               <span class="na">value=</span><span class="s">&quot;${project.toolsdir}/rhino&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;basename&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;rhino.basename&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${rhino.url}&quot;</span> <span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-101">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>We assume that the version of Rhino used is a distribution
            where the filename ends in <code>.zip</code></p>
            </td>
            <td class="code">
              <div class="highlight"><pre>       <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;.zip&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/php&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-102">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Other tasks use this property to determine the location of the
          <code>js.jar</code> file</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;rhino.jar&quot;</span>
               <span class="na">value=</span><span class="s">&quot;${rhino.dir}/${rhino.basename}/js.jar&quot;</span><span class="nt">/&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-103">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>If the Rhino js.jar file is not available then download and
          unpack Rhino</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>     <span class="nt">&lt;if&gt;</span>
       <span class="nt">&lt;not&gt;&lt;available</span> <span class="na">file=</span><span class="s">&quot;${rhino.jar}&quot;</span><span class="nt">/&gt;&lt;/not&gt;</span>
       <span class="nt">&lt;then&gt;</span>
         <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${rhino.dir}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;php</span> <span class="na">function=</span><span class="s">&quot;basename&quot;</span> <span class="na">returnProperty=</span><span class="s">&quot;rhino.zipfile&quot;</span><span class="nt">&gt;</span>
           <span class="nt">&lt;param</span> <span class="na">value=</span><span class="s">&quot;${rhino.url}&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;/php&gt;</span>
         <span class="nt">&lt;httpget</span> <span class="na">url=</span><span class="s">&quot;${rhino.url}&quot;</span>
                  <span class="na">dir=</span><span class="s">&quot;${rhino.dir}&quot;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;unzip</span> <span class="na">file=</span><span class="s">&quot;${rhino.dir}/${rhino.zipfile}&quot;</span>
                <span class="na">todir=</span><span class="s">&quot;${rhino.dir}&quot;</span> <span class="nt">/&gt;</span>
       <span class="nt">&lt;/then&gt;</span>
     <span class="nt">&lt;/if&gt;</span></pre></div>            </td>
          </tr>
                  <tr id="section-104">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Set property to prevent unnecessary additional invocations of this
          target</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>     <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;project.rhino.setup&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;/target&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</pre></div></pre></div>            </td>
          </tr>
              </tbody>
    </table>
  </div>
</body>
</html>
